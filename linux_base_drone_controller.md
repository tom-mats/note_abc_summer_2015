# Linuxベースのオープンソース フライトコントローラの概要
橋口さん

## フライトコントローラとは

* 姿勢制御やナビゲーションを行う装置
* 機体に積まれるもの
* PC側はグラウンドステーション
  * フライトプランなどを設定できる。

## ドローンでやりたい事

* 機能拡張
* 作業結果の管理
  * GPSと写真の紐付け

* DJI
  * 機体側: Onboard SDK(中身はブラックボックスだがAPIを提供)
  * 地上側; Mobile SDK (中身はブラックボックスだがAPIを提供)
* 3DR
  * 機体側: Dronecode
  * 地上側: Dronekit

* この辺は最初のメモに記載済み

## ドローンを作るには

### 最低限の機体の構成

* フレーム
* モータ、プロペラ
* FC
で構成

### 便利なキットを買う

### FCを買う
* Linuxベースのフライトコントローラを!
  * NAVIO+
  * Erle Brain

### FCの歴史

* kkMultiCopter
* ArduPilot
* MultiWii

* PX4, Pixhawk, Naze32系が多いのでは

### FCの流れ

ATmega

aruduino

cortex-M

cortex-A

### FCの開発

* Dronecode(Linuxベースで動かそう)

### Linuxだと何が良い?

* こだわりたいところをいじればよい
  * 姿勢制御
  * GNSSの精度向上(RTK)
  * 無線方式の変更
  * センサの追加
  * アクチュエーターの追加

## FCの構成

### NAVIO+のセットアップ

* ハードウェアのセットアップ
  * 受信機はPPMだけ
* Raspherry Piのセットアップ
  * RealTimeOSいりのRaspherianが最初からある
* APMのセットアップ
  * ROSとかはPX4ベース
  * Debianパッケージも最初からある
  * テレメトリーはUARTでもTCP, UDPでも可
* Raspherry Pi 2ならばビデオストリーミングも可能

### ここまでのまとめ

* Dronecodeに準拠したシステムは比較的導入簡単
* 操作側はDronekitがいいんじゃない?

## マルチコプターの制御方法

* ロール
* ピッチ
* ヨー
が基本

### 基本原理

* 前後や左右の回転数を変えて、推力のバランスを崩す事で姿勢を変える。

### 旋回

* CWの回転数をあげて CCWの回転数を下げると反作用効果のバランスが崩れて、ヨー方向に回転する。
  * チューニングが悪いと静止して行ってくれない。

### 平行移動

* 斜めにして、揚力の重力方向は重力を打ち消すようにしてあげればよい

### 制御項目

* ロール、ピッチ、ヨー角
* 高度
* 緯度、経度
* ウェイポイント情報

### 制御周期

* 2.5ms

### 制御アルゴリズム

1. センサー値の取得
1. フィルタ処理
1. 制御則の計算(PID)
1. ミキシング計算
1. モーターへの出力

#### センサー

* ジャイロセンサー MPU-6050
* 電子コンパス HMC-5883L
* 気圧 MS5611
  * 日本だと入手困難
* GNSS ubloxシリーズ
 * RTKならばLEA-6T
 * NAVIO+ならNEO-M8N
   * RTKも可能
 * GNSSとコンパスはモータから話して設置

#### フィルタ処理と応用

* ローパスフィルタ
* 相補フィルタ

#### PID制御

## 将来のFC

* ロール、ピッチ、ヨー

  -> クォータニオン

* カルマンフィルタ

  -> 姿勢精度の向上

  -> 内部センサだけで移動

* PID制御

  -> セルフチューニング

  -> 現代制御理論

## ROSの便利な点

+ レーザセンサスキャナのマッピングを自動で行ってくれる
  * 上位の部分で制御できる。

## Extended Kalman Filter

* カルマンフィルタの拡張  
